<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Slime Collector</title>
    <style>
        :root {
            --primary: #4CAF50;
            --secondary: #8BC34A;
            --dark: #2E7D32;
            --light: #C8E6C9;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Rubik', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, var(--light), #E8F5E9);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background-color: var(--primary);
            color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .header-buttons {
            margin-top: 15px;
        }
        
        .header-btn {
            background-color: var(--secondary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .header-btn:hover {
            background-color: var(--dark);
            transform: translateY(-2px);
        }
        
        .game-area {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .slime-display {
            flex: 1;
            min-width: 300px;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        #slime-image {
            width: 200px;
            height: 200px;
            object-fit: contain;
            margin: 15px auto;
            transition: transform 0.3s ease;
        }
        
        #slime-image:hover {
            transform: scale(1.05);
        }
        
        .slime-info {
            margin: 15px 0;
        }
        
        #spin-button {
            background-color: var(--secondary);
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 18px;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        #spin-button:hover {
            background-color: var(--dark);
            transform: translateY(-3px);
        }
        
        #spin-button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .inventory-area {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light);
        }
        
        .toggle-button {
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
        }
        
        .toggle-button img {
            width: 30px;
            height: 30px;
        }
        
        #inventory, #crafter {
            display: none;
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background-color: #f9f9f9;
        }
        
        .slime-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .slime-item img {
            width: 50px;
            height: 50px;
            margin-right: 15px;
            object-fit: contain;
        }
        
        .craft-recipe {
            background-color: #E8F5E9;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        
        .craft-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .craft-item img {
            width: 40px;
            height: 40px;
            margin-right: 10px;
        }
        
        .craft-button {
            background-color: var(--secondary);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .craft-button:hover {
            background-color: var(--dark);
        }
        
        @media (max-width: 768px) {
            .game-area {
                flex-direction: column;
            }
        }
        
        .save-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }
        
        .save-button {
            background-color: #2196F3;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .save-button:hover {
            background-color: #0b7dda;
        }
        
        .animation-container {
            position: relative;
            height: 220px;
            overflow: hidden;
        }
        
        .spinning-effect {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 200px;
            background: rgba(139, 195, 74, 0.1);
            border-radius: 50%;
            display: none;
            z-index: 2;
        }
        
        .rarity-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 12px;
            margin-top: 5px;
            color: white;
        }
        
        .common { background: #4CAF50; }
        .uncommon { background: #2196F3; }
        .rare { background: #9C27B0; }
        .epic { background: #FF9800; }
        .legendary { background: #F44336; }
        .mythic { background: #E91E63; }
        .divine { background: #FFEB3B; color: #333; }
        
        .crafted-badge {
            background-color: #4CAF50;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            display: inline-block;
        }
        
        .craft-error {
            animation: shake 0.5s;
            border: 2px solid red;
        }
        
        @keyframes shake {
            0%, 100% {transform: translateX(0);}
            20%, 60% {transform: translateX(-5px);}
            40%, 80% {transform: translateX(5px);}
        }
        
        @keyframes spin {
            0% { transform: translateX(-50%) scale(0.5); opacity: 0; }
            50% { transform: translateX(-50%) scale(1.2); opacity: 0.5; }
            100% { transform: translateX(-50%) scale(0.5); opacity: 0; }
        }

        .toggle-container {
            display: flex;
            align-items: center;
            margin: 10px 0;
            justify-content: center;
        }

        .toggle-label {
            margin-right: 10px;
            font-size: 14px;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--primary);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }
        
        .collections-area {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            margin-top: 20px;
        }
        
        .collection-item {
            display: flex;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background-color: #f9f9f9;
            align-items: center;
        }
        
        .collection-thumbnail {
            width: 80px;
            height: 80px;
            margin-right: 15px;
            object-fit: contain;
            border-radius: 8px;
            border: 2px solid #ddd;
        }
        
        .collection-details {
            flex: 1;
        }
        
        .collection-slimes {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 10px 0;
        }
        
        .collection-slime {
            display: flex;
            align-items: center;
            padding: 5px 10px;
            background-color: #e0f7fa;
            border-radius: 15px;
            font-size: 14px;
        }
        
        .collection-slime img {
            width: 20px;
            height: 20px;
            margin-right: 5px;
        }
        
        .collection-reward {
            background-color: #fff8e1;
            padding: 8px 12px;
            border-radius: 8px;
            font-weight: bold;
            margin-top: 5px;
            display: inline-block;
        }
        
        .collection-progress {
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: var(--primary);
            transition: width 0.5s ease;
        }
        
        .collection-status {
            font-weight: bold;
            padding: 8px 12px;
            border-radius: 5px;
            text-align: center;
            margin-top: 10px;
        }
        
        .locked {
            background-color: #ffebee;
            color: #c62828;
        }
        
        .completed {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        
        .claim-button {
            background-color: var(--secondary);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-top: 10px;
        }
        
        .claim-button:hover {
            background-color: var(--dark);
        }
        
        .claim-button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        .index-area {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            margin-top: 20px;
        }
        
        .slime-index-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
        }
        
        .slime-index-item {
            text-align: center;
            padding: 10px;
            border-radius: 10px;
            background: #f9f9f9;
            transition: transform 0.2s;
        }
        
        .slime-index-item:hover {
            transform: translateY(-5px);
            background: #e8f5e9;
        }
        
        .slime-index-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #e0e0e0;
            border-radius: 50%;
            font-size: 30px;
            color: #9e9e9e;
        }
        
        .slime-index-item.known .slime-index-icon {
            background: transparent;
        }
        
        .slime-index-name {
            margin-top: 8px;
            font-weight: bold;
        }
        
        .slime-index-rarity {
            font-size: 12px;
            margin-top: 3px;
            padding: 2px 8px;
            border-radius: 10px;
            display: inline-block;
            color: white;
        }
        
        .slime-index-unknown {
            filter: blur(5px);
            opacity: 0.7;
        }
        .rarity-badge.unknown {
            background: #9e9e9e;
        }
        .toggle-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            padding: 10px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .toggle-buttons {
            display: flex;
            gap: 10px;
        }
        
        .toggle-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        
        .toggle-btn:hover {
            background: var(--dark);
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π */
        #cheat-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #ff9800, #f44336);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            z-index: 1000;
            font-family: 'Rubik', sans-serif;
            animation: cheatSlide 0.5s ease-out;
        }
        
        @keyframes cheatSlide {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes cheatFade {
            to { opacity: 0; transform: translateY(-20px); }
        }
        .cheat-message {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .cheat-label {
            font-size: 14px;
            opacity: 0.8;
            text-align: right;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ */
        .active-effect {
            display: flex;
            align-items: center;
            padding: 8px;
            background: #f5f5f5;
            border-radius: 8px;
            margin-bottom: 8px;
        }
        .active-effect img {
            margin-right: 10px;
            border-radius: 4px;
            width: 30px;
            height: 30px;
        }
        .active-effect div {
            flex: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Slime Collector</h1>
            <p>–°–æ–±–∏—Ä–∞–π —Ä–µ–¥–∫–∏—Ö —Å–ª–∞–π–º–æ–≤ –∏ —Å–æ–∑–¥–∞–≤–∞–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã!</p>
            <div class="header-buttons">
                <button id="leaderboard-button" class="header-btn">üèÜ –¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤</button>
            </div>
        </header>
        
        <div class="game-area">
            <div class="slime-display">
                <div class="animation-container">
                    <img id="slime-image" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNTAiIGhlaWdodD0iMjUwIiB2aWV3Qm94PSIwIDAgMjAwIDIwMCI+PGNpcmNsZSBjeD0iMTAwIiBjeT0iMTAwIiByPSI4MCIgZmlsbD0iIzRjYWY1MCIvPjxjaXJjbGUgY3g9IjcwIiBjeT0iODAiIHI9IjEyIiBmaWxsPSIjZmZmIi8+PGNpcmNsZSBjeD0iMTMwIiBjeT0iODAiIHI9IjEyIiBmaWxsPSIjZmZmIi8+PHBhdGggZD0iTTgwIDEzMHEyMCAyMCA0MCAwIiBzdHJva2U9IiMzMzMiIHN0cm9rZS13aWR0aD0iOCIvPjwvc3ZnPg==" alt="Slime">
                    <div class="spinning-effect" id="spinning-effect"></div>
                </div>
                <div class="toggle-container">
                    <span class="toggle-label">–ê–Ω–∏–º–∞—Ü–∏—è:</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="animation-toggle" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="slime-info">
                    <h2 id="name">Green Slime</h2>
                    <p>–®–∞–Ω—Å: <span id="chance">1/2</span></p>
                    <div class="rarity-badge common" id="rarity-badge">–û–±—ã—á–Ω—ã–π</div>
                </div>
                <button id="spin-button">SPIN!</button>
                
                <div class="save-controls">
                    <button id="save-button" class="save-button">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    <button id="load-button" class="save-button">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
                    <button id="reset-button" class="save-button">–°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å</button>
                </div>
            </div>
           
            <div class="inventory-area">
                <div class="panel-header">
                    <div class="active-effects">
                        <h3>–ê–∫—Ç–∏–≤–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã</h3>
                        <div id="effects-list"></div>
                    </div>
                </div>
                <div class="panel-header">
                    <h2>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h2>
                    <button id="inventory-toggle" class="toggle-button">
                        <img id="backpack-image" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSIjMDAwIj48cGF0aCBkPSJNMTkgNmgtMlE1IDYgMiA5aDJxMCAzLjMxIDIuNjkgNiA2LTYgNnY1bDQtNCA0IDRWNkgxOXptLTggMTN2LTJoLTJ2LTJoMnYtMmgydjJoMnYyaC0ydjJoLTJ2LTJ6Ii8+PC9zdmc+" alt="–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å">
                    </button>
                </div>
                <div id="inventory">
                    <!-- –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
                
                <div class="panel-header">
                    <h2>–ö—Ä–∞—Ñ—Ç</h2>
                    <button id="crafter-toggle" class="toggle-button">
                        <img id="hammer-image" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSIjMDAwIj48cGF0aCBkPSJNMTMgOS44VjNoLTJ2Ni44Yy0uNTcuMzUtMS4wNi45Ni0xLjA3IDEuN2guMDJjLjAxLjQ1LjIxLjg4LjU2IDEuMjJMMTMgMTUuNDRWMTdINnYtMS41bDEuNDItMS40MkM4LjI3IDEzLjY0IDguNSAxMi44NyA4LjUgMTJjMC0xLjY5LTEuMzUtMy0zLTNzLTMgMS4zNS0zIDNjMCAuODcuMjMgMS42NC42MiAyLjI0TDYgMTUuNVYxOWg3di0zLjZsMi45Mi0yLjkyYy4zNS0uMzQuNTUtLjc3LjU2LTEuMjJoLS4wMWMtLjAxLS43NC0uNS0xLjM1LTEuMDctMS43ek0xOSAxNGMtLjU1IDAtMS0uNDUtMS0xcy40NS0xIDEtMSAxIC40NSAxIDEtLjQ1IDEtMSAxem0wLTJjLS41NSAwLTEtLjQ1LTEtMXMuNDUtMSAxLTEgMSAuNDUgMSAxLS40NSAxLTEgMXoiLz48L3N2Zz4=" alt="–ö—Ä–∞—Ñ—Ç">
                    </button>
                </div>
                <div class="panel-header">
                    <h3>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã</h3>
                    <div class="toggle-buttons">
                        <button id="toggle-collections" class="toggle-btn">–ö–æ–ª–ª–µ–∫—Ü–∏–∏</button>
                        <button id="toggle-index" class="toggle-btn">–ò–Ω–¥–µ–∫—Å</button>
                    </div>
                </div>
                <div id="crafter">
                    <!-- –ö—Ä–∞—Ñ—Ç –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
        </div>
        <div class="collections-area">
            <div class="panel-header">
                <h2>–ö–æ–ª–ª–µ–∫—Ü–∏–∏ —Å–ª–∞–π–º–æ–≤</h2>
            </div>
            <div id="collections">
                <!-- –ö–æ–ª–ª–µ–∫—Ü–∏–∏ –±—É–¥—É—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>
        <div class="index-area">
            <div class="panel-header">
                <h2>–ò–Ω–¥–µ–∫—Å —Å–ª–∞–π–º–æ–≤</h2>
            </div>
            <div id="slime-index">
                <!-- –ò–Ω–¥–µ–∫—Å –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
    const API_URL = window.location.origin;

    // Redirect to login if token becomes invalid (401)
    axios.interceptors.response.use(
        (response) => response,
        (error) => {
            if (error && error.response && error.response.status === 401) {
                try {
                    localStorage.removeItem('auth_token');
                    localStorage.removeItem('user_id');
                } catch (e) {}
                window.location.href = 'index.html';
            }
            return Promise.reject(error);
        }
    );
    const UNKNOWN_SLIME_IMAGE = "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNTAiIGhlaWdodD0iMjUwIiB2aWV3Qm94PSIwIDAgMjAwIDIwMCI+PGNpcmNsZSBjeD0iMTAwIiBjeT0iMTAwIiByPSI4MCIgZmlsbD0iI2QwZDBkMCIvPjx0ZXh0IHg9IjEwMCIgeT0iMTEwIiBmb250LXNpemU9IjcwIiBmb250LWZhbWlseT0iQXJpYWwiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiIGZpbGw9IiM2NjYiIGZvbnQtd2VpZ2h0PSJib2xkIj4/PC90ZXh0Pjwvc3ZnPg==";

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    const authToken = localStorage.getItem('auth_token');
    const userId = localStorage.getItem('user_id');
    if (!authToken || !userId) {
        window.location.href = 'index.html';
    }

    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    let SLIMES = [];
    let CRAFTS = [];
    let COLLECTIONS = [];
    let gameState = {
        multiplier: 10000000,
        harvestMultiplier: 1,
        spinCooldown: 1000,
        luck: 1,
        animationEnabled: true,
        autoSaveEnabled: true,
        collectionsVisible: true,
        indexVisible: true,
        totalSpins: 0,
        rareSlimesFound: 0
    };

    // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
    const slimeImage = document.getElementById("slime-image");
    const spinButton = document.getElementById("spin-button");
    const nameSpan = document.getElementById("name");
    const chanceSpan = document.getElementById("chance");
    const inventory = document.getElementById("inventory");
    const crafter = document.getElementById("crafter");
    const spinningEffect = document.getElementById("spinning-effect");
    const rarityBadge = document.getElementById("rarity-badge");
    const collectionsContainer = document.getElementById("collections");
    const saveButton = document.getElementById("save-button");
    const loadButton = document.getElementById("load-button");
    const resetButton = document.getElementById("reset-button");
    const effectsList = document.getElementById("effects-list");

    // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
    let inventoryOpen = false;
    let crafterOpen = false;
    let isSpinning = false;
    let spinQueue = 0;
    let autoSaveInterval;
    let isSaving = false;
    
    // –ß–∏—Ç-–∫–æ–¥—ã
    const cheatCodes = {
        "LUCK": () => {
            gameState.luck *= 100;
            return "–£–¥–∞—á–∞ +500%!";
        },
        "ALLSLIMES": () => {
            SLIMES.forEach(slime => {
                slime.amount += 10;
            });
            return "–ü–æ–ª—É—á–µ–Ω–æ –ø–æ 10 –∫–∞–∂–¥–æ–≥–æ —Å–ª–∞–π–º–∞!";
        },
        "RARE": () => {
            SLIMES.filter(s => s.rarity === "rare").forEach(slime => {
                slime.amount += 5;
            });
            return "–ü–æ–ª—É—á–µ–Ω–æ –ø–æ 5 —Ä–µ–¥–∫–∏—Ö —Å–ª–∞–π–º–æ–≤!";
        },
        "EPIC": () => {
            SLIMES.filter(s => s.rarity === "epic").forEach(slime => {
                slime.amount += 3;
            });
            return "–ü–æ–ª—É—á–µ–Ω–æ –ø–æ 3 —ç–ø–∏—á–µ—Å–∫–∏—Ö —Å–ª–∞–π–º–∞!";
        },
        "LEGENDARY": () => {
            SLIMES.filter(s => s.rarity === "legendary").forEach(slime => {
                slime.amount += 2;
            });
            return "–ü–æ–ª—É—á–µ–Ω–æ –ø–æ 2 –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã—Ö —Å–ª–∞–π–º–∞!";
        },
        "DIVINE": () => {
            SLIMES.filter(s => s.rarity === "divine").forEach(slime => {
                slime.amount += 1;
            });
            return "–ü–æ–ª—É—á–µ–Ω –±–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–ª–∞–π–º!";
        },
        "RESET": () => {
            resetProgress();
            return "–ü—Ä–æ–≥—Ä–µ—Å—Å —Å–±—Ä–æ—à–µ–Ω!";
        },
        "MASTER": () => {
            SLIMES.forEach(slime => {
                slime.amount += 100;
            });
            CRAFTS.forEach(craft => craft.created = true);
            COLLECTIONS.forEach(collection => {
                collection.completed = true;
                collection.claimed = true;
            });
            return "–°—Ç–∞—Ç—É—Å –º–∞—Å—Ç–µ—Ä–∞ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç!";
        }
    };
    let cheatBuffer = "";
    let cheatSequence = [];

    // –§—É–Ω–∫—Ü–∏–∏ API
    async function fetchGameData() {
        try {
            console.log(authToken);
            const response = await axios.get(`${API_URL}/api/load/`, {
                headers: { 'Authorization': `Token ${authToken}` }
            });
            const data = response.data;

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã
            console.log('Loading user data:', data.user);
            gameState = {
                ...gameState,
                ...data.user,
                totalSpins: data.user.total_spins,
                rareSlimesFound: data.user.rare_slimes_found,
                harvestMultiplier: data.user.harvest_multiplier,
                spinCooldown: data.user.spin_cooldown,
                luck: data.user.luck
            };
            console.log('Updated gameState:', gameState);
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ª–∞–π–º–æ–≤
            SLIMES = data.inventory.map(item => ({
                ...item.slime_type,
                amount: item.amount,
                image: `${API_URL}${item.slime_type.image}`
            }));
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—Ä–∞—Ñ—Ç–æ–≤
            CRAFTS = data.crafts.map(craftItem => ({
                ...craftItem.recipe,
                created: craftItem.is_completed,
                image: `${API_URL}${craftItem.recipe.image}`,
                cost: craftItem.recipe.ingredients.map(ing => ({
                    name: ing.slime_type.name,
                    amount: ing.amount
                })),
                effectType: craftItem.recipe.effect_type,     // <‚îÄ‚îÄ —Ç–µ–ø–µ—Ä—å camelCase
                effectValue: craftItem.recipe.effect_value
            }));

            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–π
            COLLECTIONS = data.collections.map(colItem => ({
                ...colItem.collection,
                id: parseInt(colItem.collection.id),
                completed: colItem.completed,
                claimed: colItem.claimed,
                thumbnail: `${API_URL}${colItem.collection.thumbnail}`,
                slimes: colItem.collection.requirements.map(req => ({
                    name: req.slime_type.name,
                    amount: req.amount
                })),
                effectType: colItem.collection.effect_type,  // <‚îÄ‚îÄ –¥–æ–±–∞–≤–∏—Ç—å
                effectValue: colItem.collection.effect_value // <‚îÄ‚îÄ –¥–æ–±–∞–≤–∏—Ç—å
            }));
            console.log(SLIMES);
            console.log(CRAFTS);
            console.log(COLLECTIONS);
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
            updateAnimationToggle();
            renderAll();
            renderActiveEffects();
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
        }
    }

    

    async function saveGame() {
        if (isSaving) return;
        isSaving = true;
        saveButton.textContent = "–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...";

        const saveData = {
            user: {
                animation_enabled: gameState.animationEnabled,
                auto_save_enabled: gameState.autoSaveEnabled,
                collections_visible: gameState.collectionsVisible,
                index_visible: gameState.indexVisible,
                total_spins: gameState.totalSpins,
                rare_slimes_found: gameState.rareSlimesFound,
                harvest_multiplier: gameState.harvestMultiplier,
                spin_cooldown: gameState.spinCooldown,
                luck: gameState.luck
            },
            inventory: SLIMES.map(slime => ({
            slime_type: { id: slime.id },
            amount: slime.amount
            })),
            crafts: CRAFTS.map(craft => ({
                recipe: { id: craft.id },
                is_completed: Boolean(craft.created), // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ –∏ —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö
            })),
            collections: COLLECTIONS.map(collection => ({
                collection: { id: collection.id },
                completed: Boolean(collection.completed),
                claimed: Boolean(collection.claimed)
            }))

        };

        console.log('Saving game data:', saveData);
        console.log('Current gameState:', gameState);
        
        try {
            await axios.post(`${API_URL}/api/save/`, saveData, {
                headers: { 'Authorization': `Token ${authToken}` }
            });
            console.log("–ò–≥—Ä–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ");
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
        } finally {
            setTimeout(() => {
                isSaving = false;
                saveButton.textContent = "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å";
            }, 1000);
        }
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
    async function initGame() {
        await fetchGameData();
        spinButton.addEventListener("click", spin);
        document.getElementById("inventory-toggle").addEventListener("click", toggleInventory);
        document.getElementById("crafter-toggle").addEventListener("click", toggleCrafter);
        saveButton.addEventListener("click", saveGame);
        loadButton.addEventListener("click", fetchGameData);
        resetButton.addEventListener("click", resetProgress);
        document.getElementById("leaderboard-button").addEventListener("click", openLeaderboard);
        
        document.getElementById('animation-toggle').addEventListener('change', function(e) {
            gameState.animationEnabled = e.target.checked;
            saveGame();
        });
        
        document.getElementById('toggle-collections').addEventListener('click', toggleCollections);
        document.getElementById('toggle-index').addEventListener('click', toggleIndex);
        
        // –ß–∏—Ç-–∫–æ–¥—ã
        document.addEventListener("keydown", handleCheatCode);
        
        checkCollections();
        if (gameState.autoSaveEnabled) {
            startAutoSave();
        }
    }

    function updateAnimationToggle() {
        const toggle = document.getElementById('animation-toggle');
        if (toggle) {
            toggle.checked = gameState.animationEnabled;
        }
    }

    function renderAll() {
        if (inventoryOpen) renderInventory();
        if (crafterOpen) renderCrafter();
        renderCollections();
        renderIndex();
        renderActiveEffects();
    }

    async function resetProgress() {
        if (!confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –≤–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å? –í—Å–µ –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.")) {
            return;
        }

        const originalText = resetButton.textContent;
        resetButton.textContent = "–°–±—Ä–∞—Å—ã–≤–∞–µ–º...";
        resetButton.disabled = true;

        try {
            // –õ–æ–∫–∞–ª—å–Ω—ã–π —Å–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è
            gameState = {
                multiplier: 10000000,
                harvestMultiplier: 1,
                spinCooldown: 1000,
                luck: 1,
                animationEnabled: true,
                autoSaveEnabled: true,
                collectionsVisible: true,
                indexVisible: true,
                totalSpins: 0,
                rareSlimesFound: 0
            };

            // –°–±—Ä–æ—Å —Å–ª–∞–π–º–æ–≤
            SLIMES.forEach(slime => {
                slime.amount = 0;
            });

            // –°–±—Ä–æ—Å –∫—Ä–∞—Ñ—Ç–æ–≤
            CRAFTS.forEach(craft => {
                craft.created = false;
            });

            // –°–±—Ä–æ—Å –∫–æ–ª–ª–µ–∫—Ü–∏–π
            COLLECTIONS.forEach(collection => {
                collection.completed = false;
                collection.claimed = false;
            });

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
            updateSlimeDisplay(SLIMES[0]);
            renderAll();
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–±—Ä–æ—à–µ–Ω–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
            await saveGame();
            
            showNotification("–ü—Ä–æ–≥—Ä–µ—Å—Å —É—Å–ø–µ—à–Ω–æ —Å–±—Ä–æ—à–µ–Ω!", "success");
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ —Å–±—Ä–æ—Å–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞:', error);
            showNotification("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±—Ä–æ—Å–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞", "error");
        } finally {
            resetButton.textContent = originalText;
            resetButton.disabled = false;
        }
    }

    function showNotification(message, type = "info") {
        const notification = document.createElement("div");
        notification.className = `notification ${type}`;
        notification.textContent = message;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.style.opacity = "0";
            setTimeout(() => {
                document.body.removeChild(notification);
            }, 300);
        }, 3000);
    }

    async function spin() {
        if (isSpinning) {
            spinQueue++;
            return;
        }
        
        isSpinning = true;
        spinButton.disabled = true;
        gameState.totalSpins++;
        console.log('Spin completed. Total spins:', gameState.totalSpins);
        
        if (gameState.animationEnabled) {
            spinningEffect.style.display = "block";
            spinningEffect.style.animation = "none";
            setTimeout(() => {
                spinningEffect.style.animation = "spin 1s infinite linear";
            }, 10);
            
            let spinCount = 0;
            const spinInterval = setInterval(() => {
                const randomSlime = SLIMES[Math.floor(Math.random() * SLIMES.length)];
                const isKnown = randomSlime.amount > 0;
                
                slimeImage.src = isKnown ? randomSlime.image : UNKNOWN_SLIME_IMAGE;
                nameSpan.textContent =  "???";
                
                
                rarityBadge.textContent = "???";
                rarityBadge.className = "rarity-badge unknown";
                
                
                chanceSpan.textContent =  "???";
                
                spinCount++;
                if (spinCount > 10) {
                    clearInterval(spinInterval);
                    // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–¥–µ—Ä–∂–∫—É –ø–µ—Ä–µ–¥ –ø–æ–∫–∞–∑–æ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
                    setTimeout(() => {
                        selectFinalSlime();
                    }, gameState.spinCooldown);
                }
            }, 150);
        } else {
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º spinCooldown –≤–º–µ—Å—Ç–æ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏
            setTimeout(() => {
                selectFinalSlime();
            }, gameState.spinCooldown);
        }
    }

    async function selectFinalSlime() {
        const maxRange = 10000000000;
        const randomNum = Math.floor(Math.random() * maxRange) + 1;

        let selectedSlime = null;
        let candidates = [];
        
        for (const slime of SLIMES) {
            let baseChance = parseInt(slime.chance.split('/')[1]);
            let chanceValue = baseChance;
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —É–¥–∞—á—É –∫–æ –≤—Å–µ–º –Ω–µ–æ–±—ã—á–Ω—ã–º –∏ –≤—ã—à–µ —Å–ª–∞–π–º–∞–º
            if (slime.rarity !== "common") {
                // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —à–∞–Ω—Å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —É—Ä–æ–≤–Ω—è —É–¥–∞—á–∏
                chanceValue = Math.max(1, Math.floor(baseChance / (1 + gameState.luck)));
            }
            
            if (randomNum % chanceValue === 0) {
                candidates.push(slime);
            }
        }
        
        // –ï—Å–ª–∏ –Ω–µ—Ç –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤, –≤—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω–æ–≥–æ –æ–±—ã—á–Ω–æ–≥–æ —Å–ª–∞–π–º–∞
        if (candidates.length === 0) {
            const commonSlimes = SLIMES.filter(s => s.rarity === "common");
            selectedSlime = commonSlimes.length > 0 
                ? commonSlimes[Math.floor(Math.random() * commonSlimes.length)]
                : SLIMES[0];
        } else {
            selectedSlime = candidates[Math.floor(Math.random() * candidates.length)];
        }
        
        // ...–æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
    
        
        selectedSlime = candidates.length > 0 ? 
            candidates[Math.floor(Math.random() * candidates.length)] : 
            SLIMES[0];
        
        const count = gameState.harvestMultiplier;
        selectedSlime.amount += count;
        
        // Track rare slimes for leaderboard
        if (selectedSlime.rarity !== 'common' && selectedSlime.rarity !== 'uncommon') {
            gameState.rareSlimesFound += count;
        }
        
        if (gameState.animationEnabled) {
            setTimeout(() => {
                updateSlimeDisplay(selectedSlime);
                finishSpin();
            }, 500);
        } else {
            updateSlimeDisplay(selectedSlime);
            finishSpin();
        }
        
        console.log(`–ü–æ–ª—É—á–µ–Ω–æ ${count} ${selectedSlime.name}`);
    }

    function updateSlimeDisplay(slime) {
        slimeImage.src = slime.image;
        nameSpan.textContent = slime.name;
        chanceSpan.textContent = slime.chance;
        rarityBadge.textContent = getRarityName(slime.rarity);
        rarityBadge.className = `rarity-badge ${slime.rarity}`;
    }

    function finishSpin() {
        if (gameState.animationEnabled) {
            spinningEffect.style.display = "none";
        }
        
        isSpinning = false;
        
        if (spinQueue > 0) {
            spinQueue--;
            spin();
        } else {
            spinButton.disabled = false;
        }
        
        checkCollections();
        renderAll();
    }

    // –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Ä–µ–¥–∫–æ—Å—Ç–∏
    function getRarityName(rarity) {
        const names = {
            'common': '–û–±—ã—á–Ω—ã–π',
            'uncommon': '–ù–µ–æ–±—ã—á–Ω—ã–π',
            'rare': '–†–µ–¥–∫–∏–π',
            'epic': '–≠–ø–∏—á–µ—Å–∫–∏–π',
            'legendary': '–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π',
            'mythic': '–ú–∏—Ñ–∏—á–µ—Å–∫–∏–π',
            'divine': '–ë–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π'
        };
        return names[rarity] || rarity;
    }

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
    function toggleInventory() {
        if (crafterOpen) {
            crafterOpen = false;
            crafter.style.display = "none";
        }
        
        inventoryOpen = !inventoryOpen;
        inventory.style.display = inventoryOpen ? "block" : "none";
        
        if (inventoryOpen) {
            renderInventory();
        }
    }

    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
    function renderInventory() {
        inventory.innerHTML = "";
        
        SLIMES.forEach(slime => {
            if (slime.amount > 0) {
                const slimeElement = document.createElement("div");
                slimeElement.className = "slime-item";
                slimeElement.innerHTML = `
                    <img src="${slime.image}" alt="${slime.name}">
                    <div>
                        <h3>${slime.name}</h3>
                        <p>–®–∞–Ω—Å: ${slime.chance}</p>
                        <p>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${slime.amount}</p>
                        <div class="rarity-badge ${slime.rarity}">${getRarityName(slime.rarity)}</div>
                    </div>
                `;
                inventory.appendChild(slimeElement);
            }
        });
        
        if (inventory.innerHTML === "") {
            inventory.innerHTML = "<p>–í–∞—à –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—É—Å—Ç. –ü–æ–∫—Ä—É—Ç–∏—Ç–µ —Ä—É–ª–µ—Ç–∫—É, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Å–ª–∞–π–º–æ–≤!</p>";
        }
    }

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –∫—Ä–∞—Ñ—Ç–∞
    function toggleCrafter() {
        if (inventoryOpen) {
            inventoryOpen = false;
            inventory.style.display = "none";
        }
        
        crafterOpen = !crafterOpen;
        crafter.style.display = crafterOpen ? "block" : "none";
        
        if (crafterOpen) {
            renderCrafter();
        }
    }

    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ—Ü–µ–ø—Ç–æ–≤ –∫—Ä–∞—Ñ—Ç–∞
    function renderCrafter() {
        console.log('CRAFTS:', CRAFTS);
        crafter.innerHTML = "";
        
        CRAFTS.forEach((craft, index) => {
            const craftElement = document.createElement("div");
            craftElement.className = "craft-recipe";
            craftElement.innerHTML = `
                <h3>${craft.name}</h3>
                <p>${craft.effect}</p>
                ${craft.created 
                ? '<div class="crafted-badge">–£–∂–µ —Å–æ–∑–¥–∞–Ω!</div>' 
                : `<div class="craft-item">
                    <img src="${craft.image}" alt="${craft.name}">
                    <button class="craft-button" data-index="${index}">–°–æ–∑–¥–∞—Ç—å</button>
                    </div>`
                }
                <h4>–¢—Ä–µ–±—É–µ—Ç—Å—è:</h4>
            `;
            
            craft.cost.forEach(item => {
                const slime = SLIMES.find(s => s.name === item.name);
                const hasEnough = slime && slime.amount >= item.amount;
                
                const costElement = document.createElement("div");
                costElement.className = "craft-item";
                costElement.innerHTML = `
                    <img src="${slime ? slime.image : UNKNOWN_SLIME_IMAGE}" alt="${item.name}">
                    <span>${item.name} - ${item.amount} (${slime ? slime.amount : 0}/${item.amount})</span>
                    ${hasEnough ? "‚úÖ" : "‚ùå"}
                `;
                craftElement.appendChild(costElement);
            });
            
            crafter.appendChild(craftElement);
        });
        
        document.querySelectorAll(".craft-button").forEach(button => {
            button.addEventListener("click", function() {
                const index = parseInt(this.getAttribute("data-index"));
                craftItem(index);
            });
        });
    }

    async function craftItem(index) {
        const craft = CRAFTS[index];
        if (craft.created) return;
        
        let canCraft = true;
        craft.cost.forEach(item => {
            const slime = SLIMES.find(s => s.name === item.name);
            if (!slime || slime.amount < item.amount) {
                canCraft = false;
            }
        });
        
        if (canCraft) {
            try {
                // –£–±–∏—Ä–∞–µ–º —Ä–µ—Å—É—Ä—Å—ã
                craft.cost.forEach(item => {
                    const slime = SLIMES.find(s => s.name === item.name);
                    if (slime) slime.amount -= item.amount;
                });
                
                // –ü–æ–º–µ—á–∞–µ–º –∫–∞–∫ —Å–æ–∑–¥–∞–Ω–Ω—ã–π
                craft.created = true;
                
                // –°–†–ê–ó–£ –ü–†–ò–ú–ï–ù–Ø–ï–ú –≠–§–§–ï–ö–¢ –ü–†–ò –°–û–ó–î–ê–ù–ò–ò
                applyCraftEffect(craft);
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏ –æ–±–Ω–æ–≤–ª—è–µ–º
                saveGame();
                renderCrafter();
                if (inventoryOpen) renderInventory();
                renderActiveEffects();
                
            } catch (e) {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø—Ä–µ–¥–º–µ—Ç–∞:", e);
            }
        } else {
            const craftButton = document.querySelector(`.craft-button[data-index="${index}"]`);
            if (craftButton) {
                craftButton.classList.add('craft-error');
                setTimeout(() => craftButton.classList.remove('craft-error'), 500);
            }
        }
    }

    function applyCraftEffect(craft) {
        console.log(craft.effectType)
        if (craft.effectType == "HarvestMultiplier") {
            const newValue = parseFloat((gameState.harvestMultiplier + craft.effectValue).toFixed(2));
            gameState.harvestMultiplier = newValue;
            console.log(`–ú–Ω–æ–∂–∏—Ç–µ–ª—å —É—Ä–æ–∂–∞—è —É–≤–µ–ª–∏—á–µ–Ω –Ω–∞: ${newValue}`);
        } 
        else if (craft.effectType == "LuckBoost") {
            const newValue = parseFloat((gameState.luck * craft.effectValue).toFixed(1));
            gameState.luck = newValue;
            console.log(`–£–¥–∞—á–∞ —É–≤–µ–ª–∏—á–µ–Ω–∞: +${newValue}`);
        }
        else if (craft.effectType == "SpinCooldown") {
            const newValue = Math.floor(gameState.spinCooldown * craft.effectValue);
            gameState.spinCooldown = newValue;
            console.log(`–í—Ä–∞—â–µ–Ω–∏–µ —É—Å–∫–æ—Ä–µ–Ω–æ: ${newValue}ms`);
        }
        else {
            console.log('dont understand')
        }
    }

    function checkCollections() {
        COLLECTIONS.forEach(collection => {
            // If collection is already claimed, it should remain completed
            if (collection.claimed) {
                collection.completed = true;
                return;
            }
            
            let allCompleted = true;
            
            collection.slimes.forEach(req => {
                const slime = SLIMES.find(s => s.name === req.name);
                if (!slime || slime.amount < req.amount) {
                    allCompleted = false;
                }
            });
            
            collection.completed = allCompleted;
        });
    }

    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–π
    function renderCollections() {
        collectionsContainer.innerHTML = "";
        
        COLLECTIONS.forEach(collection => {
            const collectionEl = document.createElement("div");
            collectionEl.className = "collection-item";
            
            let totalSlimes = 0;
            let collectedSlimes = 0;
            
            collection.slimes.forEach(req => {
                totalSlimes += req.amount;
                const slime = SLIMES.find(s => s.name === req.name);
                if (slime) {
                    collectedSlimes += Math.min(slime.amount, req.amount);
                }
            });
            
            const progressPercent = (collectedSlimes / totalSlimes) * 100;
            
            collectionEl.innerHTML = `
                <img class="collection-thumbnail" src="${collection.thumbnail}" alt="${collection.name}">
                <div class="collection-details">
                    <h3>${collection.name}</h3>
                    <p>${collection.description}</p>
                    
                    <div class="collection-slimes">
                        ${collection.slimes.map(req => {
                            const slime = SLIMES.find(s => s.name === req.name);
                            const hasEnough = slime && slime.amount >= req.amount;
                            return `
                                <div class="collection-slime ${hasEnough ? 'completed' : ''}">
                                    <img src="${slime ? slime.image : UNKNOWN_SLIME_IMAGE}" alt="${req.name}">
                                    <span>${req.name} (${slime ? slime.amount : 0}/${req.amount})</span>
                                </div>
                            `;
                        }).join('')}
                    </div>
                    
                    <div class="collection-progress">
                        <div class="progress-bar" style="width: ${progressPercent}%"></div>
                    </div>
                    
                    <div class="collection-reward">–ù–∞–≥—Ä–∞–¥–∞: ${collection.reward}</div>
                    
                    ${collection.completed 
                        ? collection.claimed 
                            ? `<div class="collection-status completed">–ù–∞–≥—Ä–∞–¥–∞ –ø–æ–ª—É—á–µ–Ω–∞!</div>`
                            : `<button class="claim-button" data-id="${collection.id}">–ü–æ–ª—É—á–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É</button>`
                        : `<div class="collection-status locked">–ö–æ–ª–ª–µ–∫—Ü–∏—è –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞</div>`
                    }
                </div>
            `;
            
            collectionsContainer.appendChild(collectionEl);
        });
        
        document.querySelectorAll(".claim-button").forEach(button => {
            button.addEventListener("click", function() {
                const collectionId = this.getAttribute("data-id");
                claimCollectionReward(collectionId);
            });
        });
    }

    async function claimCollectionReward(collectionId) {
        const collection = COLLECTIONS.find(c => c.id == collectionId);
        if (!collection || !collection.completed || collection.claimed) return;
        
        console.log("claimCollectionReward data:", collection);

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–æ–ª–ª–µ–∫—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞
        let allCompleted = true;
        collection.slimes.forEach(req => {
            const slime = SLIMES.find(s => s.name === req.name);
            if (!slime || slime.amount < req.amount) {
                allCompleted = false;
            }
        });
        
        if (!allCompleted) return;

    // –ü—Ä–∏–º–µ–Ω—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç –Ω–∞–≥—Ä–∞–¥—ã
        if (collection.effectType == "HarvestMultiplier") {
            const newValue = parseFloat((gameState.harvestMultiplier + collection.effectValue).toFixed(2));
            gameState.harvestMultiplier = newValue;
        }
        else if (collection.effectType == "LuckBoost") {
            const newValue = parseFloat((gameState.luck * collection.effectValue).toFixed(2));
            gameState.luck = newValue;
        }
        else if (collection.effectType == "SpinCooldown") {
            const newValue = parseFloat((gameState.spinCooldown * collection.effectValue).toFixed(2));
            gameState.spinCooldown = newValue;
        }
        
        // –ü–æ–º–µ—á–∞–µ–º –Ω–∞–≥—Ä–∞–¥—É –∫–∞–∫ –ø–æ–ª—É—á–µ–Ω–Ω—É—é –∏ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º, —á—Ç–æ –∫–æ–ª–ª–µ–∫—Ü–∏—è –æ—Å—Ç–∞–µ—Ç—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–π
        collection.claimed = true;
        collection.completed = true;
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
        saveGame();
        renderCollections();
        renderActiveEffects();
    }

    function renderIndex() {
        const indexContainer = document.getElementById("slime-index");
        if (!indexContainer) return;
        
        indexContainer.innerHTML = "";
        
        const totalSlimes = SLIMES.length;
        const collectedSlimes = SLIMES.filter(s => s.amount > 0).length;
        const progressPercent = Math.round((collectedSlimes / totalSlimes) * 100);
        
        const progressHeader = document.createElement("div");
        progressHeader.className = "panel-header";
        progressHeader.innerHTML = `<h3>–ü—Ä–æ–≥—Ä–µ—Å—Å: ${collectedSlimes}/${totalSlimes} (${progressPercent}%)</h3>`;
        indexContainer.appendChild(progressHeader);
        
        const gridContainer = document.createElement("div");
        gridContainer.className = "slime-index-grid";
        indexContainer.appendChild(gridContainer);
        
        const rarityOrder = ['divine', 'mythic', 'legendary', 'epic', 'rare', 'uncommon', 'common'];
        const sortedSlimes = [...SLIMES].sort((a, b) => {
            return rarityOrder.indexOf(a.rarity) - rarityOrder.indexOf(b.rarity);
        });
        
        sortedSlimes.forEach(slime => {
            const isKnown = slime.amount > 0;
            const item = document.createElement("div");
            item.className = `slime-index-item ${isKnown ? 'known' : 'unknown'}`;
            
            item.innerHTML = `
                <div class="slime-index-icon">
                    ${isKnown 
                        ? `<img src="${slime.image}" alt="${slime.name}" width="70" height="70">` 
                        : '?'}
                </div>
                <div class="slime-index-name">${isKnown ? slime.name : '???'}</div>
                ${isKnown 
                    ? `<div class="slime-index-rarity ${slime.rarity}">${getRarityName(slime.rarity)}</div>`
                    : ''}
            `;
            
            if (isKnown) {
                item.title = `${slime.name}\n–®–∞–Ω—Å: ${slime.chance}\n–†–µ–¥–∫–æ—Å—Ç—å: ${getRarityName(slime.rarity)}`;
            }
            
            gridContainer.appendChild(item);
        });
    }

    function renderActiveEffects() {
        effectsList.innerHTML = "";

        const effects = [];
        
      
        effects.push({
            name: "–ú–Ω–æ–∂–∏—Ç–µ–ª—å —É—Ä–æ–∂–∞—è",
            description: `x${gameState.harvestMultiplier} —Å–ª–∞–π–º–æ–≤ –∑–∞ —Å–ø–∏–Ω`,
        });
        
        
        effects.push({
            name: "–£–¥–∞—á–∞",
            description: `x${gameState.luck} –∫ —à–∞–Ω—Å—É —Ä–µ–¥–∫–∏—Ö —Å–ª–∞–π–º–æ–≤`,
        });
        
        
        effects.push({
            name: "–°–∫–æ—Ä–æ—Å—Ç—å –≤—Ä–∞—â–µ–Ω–∏—è",
            description: `${gameState.spinCooldown} –º—Å –∑–∞–¥–µ—Ä–∂–∫–∏`,
        });
        

        // –†–µ–Ω–¥–µ—Ä–∏–º —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
        effects.forEach(effect => {
            const effectElement = document.createElement("div");
            effectElement.className = "active-effect";
            effectElement.innerHTML = `
                <div>
                    <strong>${effect.name}</strong>
                    <div>${effect.description}</div>
                </div>
            `;
            effectsList.appendChild(effectElement);
        });

        if (effects.length === 0) {
            effectsList.innerHTML = "<p>–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤</p>";
        }
    }

    function toggleCollections() {
        gameState.collectionsVisible = !gameState.collectionsVisible;
        document.querySelector('.collections-area').style.display = 
            gameState.collectionsVisible ? 'block' : 'none';
        document.getElementById('toggle-collections').textContent = 
            gameState.collectionsVisible ? '–°–∫—Ä—ã—Ç—å –∫–æ–ª–ª–µ–∫—Ü–∏–∏' : '–ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–ª–ª–µ–∫—Ü–∏–∏';
        saveGame();
    }
    
    function toggleIndex() {
        gameState.indexVisible = !gameState.indexVisible;
        document.querySelector('.index-area').style.display = 
            gameState.indexVisible ? 'block' : 'none';
        document.getElementById('toggle-index').textContent = 
            gameState.indexVisible ? '–°–∫—Ä—ã—Ç—å –∏–Ω–¥–µ–∫—Å' : '–ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω–¥–µ–∫—Å';
        saveGame();
    }

    function startAutoSave() {
        autoSaveInterval = setInterval(() => {
            saveGame();
            console.log("–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...");
        }, 30000);
    }
    
    function openLeaderboard() {
        window.open('leaderboard.html', '_blank');
    }

    function handleCheatCode(e) {
        if (e.ctrlKey || e.altKey || e.metaKey) return;
        
        cheatBuffer += e.key.toUpperCase();
        
        for (const code in cheatCodes) {
            if (cheatBuffer.includes(code)) {
                if (activateCheat(code)) {
                    cheatBuffer = "";
                    return;
                }
            }
        }
        
        if (cheatBuffer.length > 20) {
            cheatBuffer = "";
        }
        
        cheatSequence.push(e.key);
        if (cheatSequence.length > 10) cheatSequence.shift();
        
        const konami = ["ArrowUp", "ArrowUp", "ArrowDown", "ArrowDown", 
                        "ArrowLeft", "ArrowRight", "ArrowLeft", "ArrowRight",
                        "b", "a"];
        
        if (cheatSequence.join(",") === konami.join(",")) {
            activateCheat("MASTER");
            cheatSequence = [];
        }
    }

    function activateCheat(code) {
        if (cheatCodes[code]) {
            const message = cheatCodes[code]();
            showCheatNotification(message);
            
            renderAll();
            saveGame();
            
            return true;
        }
        return false;
    }

    function showCheatNotification(message) {
        const notification = document.createElement("div");
        notification.id = "cheat-notification";
        notification.innerHTML = `
            <div class="cheat-message">${message}</div>
            <div class="cheat-label">–ß–∏—Ç-–∫–æ–¥ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω</div>
        `;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.style.animation = "cheatFade 0.5s forwards";
            setTimeout(() => {
                document.body.removeChild(notification);
            }, 500);
        }, 3000);
    }

    // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
    window.addEventListener("DOMContentLoaded", initGame);
    </script>
</body>
</html>