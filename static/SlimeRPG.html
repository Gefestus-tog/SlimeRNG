<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Slime Collector</title>
    <style>
        :root {
            --primary: #4CAF50;
            --secondary: #8BC34A;
            --dark: #2E7D32;
            --light: #C8E6C9;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Rubik', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, var(--light), #E8F5E9);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background-color: var(--primary);
            color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .game-area {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .slime-display {
            flex: 1;
            min-width: 300px;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        #slime-image {
            width: 200px;
            height: 200px;
            object-fit: contain;
            margin: 15px auto;
            transition: transform 0.3s ease;
        }
        
        #slime-image:hover {
            transform: scale(1.05);
        }
        
        .slime-info {
            margin: 15px 0;
        }
        
        #spin-button {
            background-color: var(--secondary);
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 18px;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        #spin-button:hover {
            background-color: var(--dark);
            transform: translateY(-3px);
        }
        
        #spin-button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .inventory-area {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light);
        }
        
        .toggle-button {
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
        }
        
        .toggle-button img {
            width: 30px;
            height: 30px;
        }
        
        #inventory, #crafter {
            display: none;
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background-color: #f9f9f9;
        }
        
        .slime-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .slime-item img {
            width: 50px;
            height: 50px;
            margin-right: 15px;
            object-fit: contain;
        }
        
        .craft-recipe {
            background-color: #E8F5E9;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        
        .craft-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .craft-item img {
            width: 40px;
            height: 40px;
            margin-right: 10px;
        }
        
        .craft-button {
            background-color: var(--secondary);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .craft-button:hover {
            background-color: var(--dark);
        }
        
        @media (max-width: 768px) {
            .game-area {
                flex-direction: column;
            }
        }
        
        .save-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }
        
        .save-button {
            background-color: #2196F3;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .save-button:hover {
            background-color: #0b7dda;
        }
        
        .animation-container {
            position: relative;
            height: 220px;
            overflow: hidden;
        }
        
        .spinning-effect {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 200px;
            background: rgba(139, 195, 74, 0.1);
            border-radius: 50%;
            display: none;
            z-index: 2;
        }
        
        .rarity-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 12px;
            margin-top: 5px;
            color: white;
        }
        
        .common { background: #4CAF50; }
        .uncommon { background: #2196F3; }
        .rare { background: #9C27B0; }
        .epic { background: #FF9800; }
        .legendary { background: #F44336; }
        .mythic { background: #E91E63; }
        .divine { background: #FFEB3B; color: #333; }
        
        .crafted-badge {
            background-color: #4CAF50;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            display: inline-block;
        }
        
        .craft-error {
            animation: shake 0.5s;
            border: 2px solid red;
        }
        
        @keyframes shake {
            0%, 100% {transform: translateX(0);}
            20%, 60% {transform: translateX(-5px);}
            40%, 80% {transform: translateX(5px);}
        }
        
        @keyframes spin {
            0% { transform: translateX(-50%) scale(0.5); opacity: 0; }
            50% { transform: translateX(-50%) scale(1.2); opacity: 0.5; }
            100% { transform: translateX(-50%) scale(0.5); opacity: 0; }
        }

        .toggle-container {
            display: flex;
            align-items: center;
            margin: 10px 0;
            justify-content: center;
        }

        .toggle-label {
            margin-right: 10px;
            font-size: 14px;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--primary);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }
        /* Новые стили для коллекций */
        .collections-area {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            margin-top: 20px;
        }
        
        .collection-item {
            display: flex;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background-color: #f9f9f9;
            align-items: center;
        }
        
        .collection-thumbnail {
            width: 80px;
            height: 80px;
            margin-right: 15px;
            object-fit: contain;
            border-radius: 8px;
            border: 2px solid #ddd;
        }
        
        .collection-details {
            flex: 1;
        }
        
        .collection-slimes {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 10px 0;
        }
        
        .collection-slime {
            display: flex;
            align-items: center;
            padding: 5px 10px;
            background-color: #e0f7fa;
            border-radius: 15px;
            font-size: 14px;
        }
        
        .collection-slime img {
            width: 20px;
            height: 20px;
            margin-right: 5px;
        }
        
        .collection-reward {
            background-color: #fff8e1;
            padding: 8px 12px;
            border-radius: 8px;
            font-weight: bold;
            margin-top: 5px;
            display: inline-block;
        }
        
        .collection-progress {
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: var(--primary);
            transition: width 0.5s ease;
        }
        
        .collection-status {
            font-weight: bold;
            padding: 8px 12px;
            border-radius: 5px;
            text-align: center;
            margin-top: 10px;
        }
        
        .locked {
            background-color: #ffebee;
            color: #c62828;
        }
        
        .completed {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        
        .claim-button {
            background-color: var(--secondary);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-top: 10px;
        }
        
        .claim-button:hover {
            background-color: var(--dark);
        }
        
        .claim-button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        .index-area {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            margin-top: 20px;
        }
        
        .slime-index-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
        }
        
        .slime-index-item {
            text-align: center;
            padding: 10px;
            border-radius: 10px;
            background: #f9f9f9;
            transition: transform 0.2s;
        }
        
        .slime-index-item:hover {
            transform: translateY(-5px);
            background: #e8f5e9;
        }
        
        .slime-index-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #e0e0e0;
            border-radius: 50%;
            font-size: 30px;
            color: #9e9e9e;
        }
        
        .slime-index-item.known .slime-index-icon {
            background: transparent;
        }
        
        .slime-index-name {
            margin-top: 8px;
            font-weight: bold;
        }
        
        .slime-index-rarity {
            font-size: 12px;
            margin-top: 3px;
            padding: 2px 8px;
            border-radius: 10px;
            display: inline-block;
            color: white;
        }
        
        .slime-index-unknown {
            filter: blur(5px);
            opacity: 0.7;
        }
        .rarity-badge.unknown {
            background: #9e9e9e;
        }
        .toggle-section {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 20px;
        padding: 10px;
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .toggle-buttons {
        display: flex;
        gap: 10px;
    }
    
    .toggle-btn {
        background: var(--primary);
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        transition: background 0.3s;
    }
    
    .toggle-btn:hover {
        background: var(--dark);
    }
        
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Slime Collector</h1>
            <p>Собирай редких слаймов и создавай уникальные предметы!</p>
        </header>
        
        <div class="game-area">
            <div class="slime-display">
                <div class="animation-container">
                    <img id="slime-image" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNTAiIGhlaWdodD0iMjUwIiB2aWV3Qm94PSIwIDAgMjAwIDIwMCI+PGNpcmNsZSBjeD0iMTAwIiBjeT0iMTAwIiByPSI4MCIgZmlsbD0iIzRjYWY1MCIvPjxjaXJjbGUgY3g9IjcwIiBjeT0iODAiIHI9IjEyIiBmaWxsPSIjZmZmIi8+PGNpcmNsZSBjeD0iMTMwIiBjeT0iODAiIHI9IjEyIiBmaWxsPSIjZmZmIi8+PHBhdGggZD0iTTgwIDEzMHEyMCAyMCA0MCAwIiBzdHJva2U9IiMzMzMiIHN0cm9rZS13aWR0aD0iOCIvPjwvc3ZnPg==" alt="Slime">
                    <div class="spinning-effect" id="spinning-effect"></div>
                </div>
                <div class="toggle-container">
                    <span class="toggle-label">Анимация:</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="animation-toggle" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="slime-info">
                    <h2 id="name">Green Slime</h2>
                    <p>Шанс: <span id="chance">1/2</span></p>
                    <div class="rarity-badge common" id="rarity-badge">Обычный</div>
                </div>
                <button id="spin-button">SPIN!</button>
                
                <div class="save-controls">
                    <button id="save-button" class="save-button">Сохранить</button>
                    <button id="load-button" class="save-button">Загрузить</button>
                    <button id="reset-button" class="save-button">Сбросить прогресс</button>
                </div>
            </div>
           
            <div class="inventory-area">
                <div class="panel-header">
                    <div class="active-effects">
                        <h3>Активные эффекты</h3>
                        <div id="effects-list"></div>
                    </div>
                </div>
                <div class="panel-header">
                    <h2>Инвентарь</h2>
                    <button id="inventory-toggle" class="toggle-button">
                        <img id="backpack-image" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSIjMDAwIj48cGF0aCBkPSJNMTkgNmgtMlE1IDYgMiA5aDJxMCAzLjMxIDIuNjkgNiA2LTYgNnY1bDQtNCA0IDRWNkgxOXptLTggMTN2LTJoLTJ2LTJoMnYtMmgydjJoMnYyaC0ydjJoLTJ2LTJ6Ii8+PC9zdmc+" alt="Инвентарь">
                    </button>
                </div>
                <div id="inventory">
                    <!-- Инвентарь будет заполняться динамически -->
                </div>
                
                <div class="panel-header">
                    <h2>Крафт</h2>
                    <button id="crafter-toggle" class="toggle-button">
                        <img id="hammer-image" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSIjMDAwIj48cGF0aCBkPSJNMTMgOS44VjNoLTJ2Ni44Yy0uNTcuMzUtMS4wNi45Ni0xLjA3IDEuN2guMDJjLjAxLjQ1LjIxLjg4LjU2IDEuMjJMMTMgMTUuNDRWMTdINnYtMS41bDEuNDItMS40MkM4LjI3IDEzLjY0IDguNSAxMi44NyA4LjUgMTJjMC0xLjY5LTEuMzUtMy0zLTNzLTMgMS4zNS0zIDNjMCAuODcuMjMgMS42NC42MiAyLjI0TDYgMTUuNVYxOWg3di0zLjZsMi45Mi0yLjkyYy4zNS0uMzQuNTUtLjc3LjU2LTEuMjJoLS4wMWMtLjAxLS43NC0uNS0xLjM1LTEuMDctMS43ek0xOSAxNGMtLjU1IDAtMS0uNDUtMS0xcy40NS0xIDEtMSAxIC40NSAxIDEtLjQ1IDEtMSAxem0wLTJjLS41NSAwLTEtLjQ1LTEtMXMuNDUtMSAxLTEgMSAuNDUgMSAxLS40NSAxLTEgMXoiLz48L3N2Zz4=" alt="Крафт">
                    </button>
                </div>
                <div class="panel-header">
                    <h3>Дополнительные разделы</h3>
                    <div class="toggle-buttons">
                        <button id="toggle-collections" class="toggle-btn">Коллекции</button>
                        <button id="toggle-index" class="toggle-btn">Индекс</button>
                    </div>
                </div>
                <div id="crafter">
                    <!-- Крафт будет заполняться динамически -->
                </div>
            </div>
        </div>
        <div class="collections-area">
            <div class="panel-header">
                <h2>Коллекции слаймов</h2>
            </div>
            <div id="collections">
                <!-- Коллекции будут заполняться динамически -->
            </div>
        </div>
        <div class="index-area">
            <div class="panel-header">
                <h2>Индекс слаймов</h2>
            </div>
            <div id="slime-index">
                <!-- Индекс будет заполняться динамически -->
            </div>
        </div>
    </div>

    <script>
        // Новый массив слаймов с реальными шансами от 1/2 до 1/10,000,000,000
        const SLIMES = [
            // Обычные (Common) 1/2 - 1/100
            { name: "Зелёный Слайм", image: "assets/slimes/common/green_slime.png", chance: "1/2", amount: 0, rarity: "common" }, // ✅
            { name: "Синий Слайм", image: "assets/slimes/common/blue_slime.png", chance: "1/5", amount: 0, rarity: "common" }, // ✅
            { name: "Красный Слайм", image: "assets/slimes/common/red_slime.png", chance: "1/10", amount: 0, rarity: "common" }, // ✅
            { name: "Жёлтый Слайм", image: "assets/slimes/common/yellow_slime.png", chance: "1/20", amount: 0, rarity: "common" }, // ✅
            { name: "Фиолетовый Слайм", image: "assets/slimes/common/purple_slime.png", chance: "1/50", amount: 0, rarity: "common" }, // ✅
            { name: "Оранжевый Слайм", image: "assets/slimes/common/orange_slime.png", chance: "1/100", amount: 0, rarity: "common" }, // ✅
            
            // Необычные (Uncommon) 1/200 - 1/1,000
            { name: "Болотный Слайм", image: "assets/slimes/uncommon/swamp_slime.png", chance: "1/200", amount: 0, rarity: "uncommon" }, // ✅
            { name: "Ледяной Слайм", image: "assets/slimes/uncommon/ice_slime.png", chance: "1/300", amount: 0, rarity: "uncommon" },  // ✅
            { name: "Огненный Слайм", image: "assets/slimes/uncommon/fire_slime.png", chance: "1/400", amount: 0, rarity: "uncommon" }, // ✅
            { name: "Электрический Слайм", image: "assets/slimes/uncommon/electric_slime.png", chance: "1/500", amount: 0, rarity: "uncommon" }, // ✅
            { name: "Каменный Слайм", image: "assets/slimes/uncommon/stone_slime.webp", chance: "1/750", amount: 0, rarity: "uncommon" }, // ❌
            { name: "Водный Слайм", image: "assets/slimes/uncommon/water_slime.png", chance: "1/1000", amount: 0, rarity: "uncommon" }, // ✅
            
            // Редкие (Rare) 1/2,000 - 1/10,000
            { name: "Ведьма Слайм", image: "assets/slimes/rare/witch_slime.png", chance: "1/2000", amount: 0, rarity: "rare" }, // ✅
            { name: "Кристальный Слайм", image: "assets/slimes/rare/crystal_slime.webp", chance: "1/3000", amount: 0, rarity: "rare" }, // ❌
            { name: "Лунный Слайм", image: "assets/slimes/rare/moon_slime.png", chance: "1/5000", amount: 0, rarity: "rare" }, // ✅
            { name: "Солнечный Слайм", image: "assets/slimes/rare/sun_slime.png", chance: "1/7500", amount: 0, rarity: "rare" }, // ✅
            { name: "Звёздный Слайм", image: "assets/slimes/rare/star_slime.webp", chance: "1/10000", amount: 0, rarity: "rare" }, // ❌
            
            // Эпические (Epic) 1/25,000 - 1/100,000
            { name: "Металлический Слайм", image: "assets/slimes/epic/metal_slime.png", chance: "1/25000", amount: 0, rarity: "epic" }, // ✅
            { name: "Серебряный Слайм", image: "assets/slimes/epic/silver_slime.webp", chance: "1/50000", amount: 0, rarity: "epic" }, // ❌
            { name: "Золотой Слайм", image: "assets/slimes/epic/golden_slime.png", chance: "1/75000", amount: 0, rarity: "epic" }, // ✅
            { name: "Алмазный Слайм", image: "assets/slimes/epic/diamond_slime.webp", chance: "1/100000", amount: 0, rarity: "epic" }, // ❌
            
            // Легендарные (Legendary) 1/250,000 - 1/1,000,000
            { name: "Драконий Слайм", image: "assets/slimes/legendary/dragon_slime.webp", chance: "1/250000", amount: 0, rarity: "legendary" }, // ❌
            { name: "Фениксовый Слайм", image: "assets/slimes/legendary/phoenix_slime.webp", chance: "1/500000", amount: 0, rarity: "legendary" }, // ❌
            { name: "Единорожный Слайм", image: "assets/slimes/legendary/unicorn_slime.webp", chance: "1/750000", amount: 0, rarity: "legendary" }, // ❌
            { name: "Космический Слайм", image: "assets/slimes/legendary/space_slime.webp", chance: "1/1000000", amount: 0, rarity: "legendary" }, // ❌
            
            // Мифические (Mythic) 1/5,000,000 - 1/100,000,000
            { name: "Временной Слайм", image: "assets/slimes/mythic/time_slime.png", chance: "1/5000000", amount: 0, rarity: "mythic" }, // ✅
            { name: "Пространственный Слайм", image: "assets/slimes/mythic/space_slime.webp", chance: "1/10000000", amount: 0, rarity: "mythic" }, // ❌
            { name: "Слайм Земля", image: "assets/slimes/mythic/earth_slime.png", chance: "1/50000000", amount: 0, rarity: "mythic" }, // ✅
            { name: "Божественный Слайм", image: "assets/slimes/mythic/divine_slime.webp", chance: "1/100000000", amount: 0, rarity: "mythic" }, // ❌
            
            // Божественные (Divine) 1/1,000,000,000 - 1/10,000,000,000
            { name: "Творческий Слайм", image: "assets/slimes/divine/creator_slime.webp", chance: "1/1000000000", amount: 0, rarity: "divine" }, // ❌
            { name: "Первозданный Слайм", image: "assets/slimes/divine/primal_slime.webp", chance: "1/5000000000", amount: 0, rarity: "divine" }, // ❌
            { name: "Абсолютный Слайм", image: "assets/slimes/divine/absolute_slime.webp", chance: "1/10000000000", amount: 0, rarity: "divine" } // ❌
        ];

        // Рецепты крафта
        const CRAFTS = [
            {
                name: "Амулет Слаймов",
                image: "assets/craft-items/amulet.png",
                cost: [
                    { name: "Зелёный Слайм", amount: 5 },
                    { name: "Синий Слайм", amount: 2 },
                    { name: "Электрический Слайм", amount: 1 }
                ],
                effect: "Увеличивает шанс на редких слаймов",
                created: false
            },
            {
                name: "Амулет Урожая",
                image: "assets/craft-items/harvest_amulet.png",
                cost: [
                { name: "Зелёный Слайм", amount: 20 },
                { name: "Жёлтый Слайм", amount: 5 },
                { name: "Золотой Слайм", amount: 1 }
                ],
                effect: "Увеличивает получаемое количество слаймов",
                created: false,
                applyEffect: function() {
                harvestMultiplier = 2; // Удваивает получаемых слаймов
                }
            },
            {
                name: "Амулет Вечности",
                image: "assets/craft-items/eternity_amulet.png",
                cost: [
                { name: "Лунный Слайм", amount: 1 },
                { name: "Солнечный Слайм", amount: 1 },
                { name: "Временной Слайм", amount: 1 }
                ],
                effect: "Уменьшает время восстановления спина",
                created: false,
                applyEffect: function() {
                spinCooldown *= 0.5; // Уменьшает время ожидания вдвое
                }
            },
            {
                name: "Амулет Изобилия",
                image: "assets/craft-items/abundance_amulet.png",
                cost: [
                { name: "Фиолетовый Слайм", amount: 10 },
                { name: "Оранжевый Слайм", amount: 5 },
                { name: "Божественный Слайм", amount: 1 }
                ],
                effect: "Увеличивает шанс на получение эпических слаймов",
                created: false,
                applyEffect: function() {
                epicChanceBoost = 3; // Утраивает шанс на эпических слаймов
                }
            }
        ].map(craft => {
            craft.created = craft.created || false; // Гарантируем наличие свойства
            return craft;
        });
        const COLLECTIONS = [
            {
                id: "starting",
                name: "Начальные слаймы",
                description: "Собери всех основных слаймов",
                thumbnail: "assets/collections/basic.png",
                slimes: [
                    { name: "Зелёный Слайм", amount: 1 },
                    { name: "Синий Слайм", amount: 1 },
                    { name: "Красный Слайм", amount: 1 },
                    { name: "Жёлтый Слайм", amount: 1 }
                ],
                reward: "Перманентно +5% к шансу на эпических слаймов",
                completed: false,
                claimed: false
            },
            {
                id: "elemental",
                name: "Элементальные слаймы",
                description: "Собери слаймов всех стихий",
                thumbnail: "assets/collections/elemental.png",
                slimes: [
                    { name: "Ледяной Слайм", amount: 1 },
                    { name: "Огненный Слайм", amount: 1 },
                    { name: "Электрический Слайм", amount: 1 },
                    { name: "Водный Слайм", amount: 1 }
                ],
                reward: "Увеличивает получаемое количество слаймов на 1",
                completed: false,
                claimed: false
            },
            {
                id: "rare_ones",
                name: "Редкие экземпляры",
                description: "Собери самых редких слаймов",
                thumbnail: "assets/collections/rare.png",
                slimes: [
                    { name: "Космический Слайм", amount: 1 },
                    { name: "Временной Слайм", amount: 1 },
                    { name: "Божественный Слайм", amount: 1 }
                ],
                reward: "Уменьшает время восстановления спина на 30%",
                completed: false,
                claimed: false
            },
            {
                id: "all_common",
                name: "Все обычные",
                description: "Собери по 10 экземпляров каждого обычного слайма",
                thumbnail: "assets/collections/all_common.png",
                slimes: [
                    { name: "Зелёный Слайм", amount: 10 },
                    { name: "Синий Слайм", amount: 10 },
                    { name: "Красный Слайм", amount: 10 },
                    { name: "Жёлтый Слайм", amount: 10 },
                    { name: "Фиолетовый Слайм", amount: 10 },
                    { name: "Оранжевый Слайм", amount: 10 }
                ],
                reward: "Перманентно +10% к шансу на редких слаймов",
                completed: false,
                claimed: false
            },
            {
                id: "mythic_set",
                name: "Мифический набор",
                description: "Собери всех мифических слаймов",
                thumbnail: "assets/collections/mythic.png",
                slimes: [
                    { name: "Временной Слайм", amount: 1 },
                    { name: "Пространственный Слайм", amount: 1 },
                    { name: "Слайм Земля", amount: 1 },
                    { name: "Божественный Слайм", amount: 1 }
                ],
                reward: "Удваивает шанс на получение божественных слаймов",
                completed: false,
                claimed: false
            }
        ];
        const cheatCodes = {
            "ALLSLIMES": () => {
                SLIMES.forEach(slime => {
                    slime.amount += 10;
                });
                return "Получено по 10 каждого слайма!";
            },
            "RARE": () => {
                SLIMES.filter(s => s.rarity === "rare").forEach(slime => {
                    slime.amount += 5;
                });
                return "Получено по 5 редких слаймов!";
            },
            "EPIC": () => {
                SLIMES.filter(s => s.rarity === "epic").forEach(slime => {
                    slime.amount += 3;
                });
                return "Получено по 3 эпических слайма!";
            },
            "LEGENDARY": () => {
                SLIMES.filter(s => s.rarity === "legendary").forEach(slime => {
                    slime.amount += 2;
                });
                return "Получено по 2 легендарных слайма!";
            },
            "DIVINE": () => {
                SLIMES.filter(s => s.rarity === "divine").forEach(slime => {
                    slime.amount += 1;
                });
                return "Получен божественный слайм!";
            },
            "RESET": () => {
                resetProgress();
                return "Прогресс сброшен!";
            },
            "MASTER": () => {
                SLIMES.forEach(slime => {
                    slime.amount += 100;
                });
                CRAFTS.forEach(craft => craft.created = true);
                COLLECTIONS.forEach(collection => {
                    collection.completed = true;
                    collection.claimed = true;
                });
                updateActiveEffects();
                return "Статус мастера достигнут!";
            }
        };
        const UNKNOWN_SLIME_IMAGE = "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNTAiIGhlaWdodD0iMjUwIiB2aWV3Qm94PSIwIDAgMjAwIDIwMCI+PGNpcmNsZSBjeD0iMTAwIiBjeT0iMTAwIiByPSI4MCIgZmlsbD0iI2QwZDBkMCIvPjx0ZXh0IHg9IjEwMCIgeT0iMTEwIiBmb250LXNpemU9IjcwIiBmb250LWZhbWlseT0iQXJpYWwiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiIGZpbGw9IiM2NjYiIGZvbnQtd2VpZ2h0PSJib2xkIj4/PC90ZXh0Pjwvc3ZnPg==";

        let cheatBuffer = "";
        const cheatSequence = []; // Для последовательностей клавиш

        function activateCheat(code) {
            if (cheatCodes[code]) {
                const message = cheatCodes[code]();
                showCheatNotification(message);
                
                // Обновляем интерфейс
                if (inventoryOpen) renderInventory();
                if (crafterOpen) renderCrafter();
                renderCollections();
                renderActiveEffects();
                
                // Сохраняем игру
                saveGame();
                
                return true;
            }
            return false;
        }
        function showCheatNotification(message) {
            // Создаем элемент уведомления
            const notification = document.createElement("div");
            notification.id = "cheat-notification";
            notification.innerHTML = `
                <div class="cheat-message">${message}</div>
                <div class="cheat-label">Чит-код активирован</div>
            `;
            
            // Добавляем стили
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #ff9800, #f44336);
                color: white;
                padding: 15px 25px;
                border-radius: 10px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.3);
                z-index: 1000;
                font-family: 'Rubik', sans-serif;
                animation: cheatSlide 0.5s ease-out;
            `;
            
            document.body.appendChild(notification);
            
            // Удаляем через 3 секунды
            setTimeout(() => {
                notification.style.animation = "cheatFade 0.5s forwards";
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 500);
            }, 3000);
        }

        // Добавляем обработчик клавиатуры
        document.addEventListener("keydown", (e) => {
            // Игнорируем специальные клавиши
            if (e.ctrlKey || e.altKey || e.metaKey) return;
            
            // Добавляем клавишу в буфер
            cheatBuffer += e.key.toUpperCase();
            
            // Проверяем активные чит-коды
            for (const code in cheatCodes) {
                if (cheatBuffer.includes(code)) {
                    if (activateCheat(code)) {
                        cheatBuffer = "";
                        return;
                    }
                }
            }
            
            // Очищаем буфер если он слишком большой
            if (cheatBuffer.length > 20) {
                cheatBuffer = "";
            }
            
            // Секретные последовательности (например, ↑↑↓↓←→←→BA)
            cheatSequence.push(e.key);
            if (cheatSequence.length > 10) cheatSequence.shift();
            
            // Проверка Konami Code (↑↑↓↓←→←→BA)
            const konami = ["ArrowUp", "ArrowUp", "ArrowDown", "ArrowDown", 
                            "ArrowLeft", "ArrowRight", "ArrowLeft", "ArrowRight",
                            "b", "a"];
            
            if (cheatSequence.join(",") === konami.join(",")) {
                activateCheat("MASTER");
                cheatSequence.length = 0;
            }
        });

        // Добавляем стили для анимации
        const cheatStyles = document.createElement("style");
        cheatStyles.innerHTML = `
            @keyframes cheatSlide {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes cheatFade {
                to { opacity: 0; transform: translateY(-20px); }
            }
            .cheat-message {
                font-size: 18px;
                font-weight: bold;
                margin-bottom: 5px;
            }
            .cheat-label {
                font-size: 14px;
                opacity: 0.8;
                text-align: right;
            }
        `;
        document.head.appendChild(cheatStyles);
        // Элементы DOM
        const slimeImage = document.getElementById("slime-image");
        const spinButton = document.getElementById("spin-button");
        const nameSpan = document.getElementById("name");
        const chanceSpan = document.getElementById("chance");
        const inventory = document.getElementById("inventory");
        const backpackImage = document.getElementById("backpack-image");
        const crafter = document.getElementById("crafter");
        const hammerImage = document.getElementById("hammer-image");
        const inventoryToggle = document.getElementById("inventory-toggle");
        const crafterToggle = document.getElementById("crafter-toggle");
        const saveButton = document.getElementById("save-button");
        const loadButton = document.getElementById("load-button");
        const resetButton = document.getElementById("reset-button");
        const spinningEffect = document.getElementById("spinning-effect");
        const rarityBadge = document.getElementById("rarity-badge");
        const collectionsContainer = document.getElementById("collections");

        // Состояние игры
        let inventoryOpen = false;
        let crafterOpen = false;
        let multiplier = 10000000;
        let autoSaveEnabled = true;
        let autoSaveInterval;
        let animationEnabled = true;
        let isSpinning = false;
        let spinQueue = 0;
        
        // Добавляем инициализацию переменных бонусов
        let harvestMultiplier = 1;
        let spinCooldown = 1000;
        let rareChanceBoost = 0;
        let epicChanceBoost = 0;
        let divineChanceMultiplier = 1;
       
        let collectionsVisible = true;
        let indexVisible = true;
        
        // Добавляем в функцию initGame
        document.getElementById('toggle-collections').addEventListener('click', toggleCollections);
        document.getElementById('toggle-index').addEventListener('click', toggleIndex);

        let activeEffects = {
            harvestMultiplier: 1,   // Множитель количества выпадающих слаймов
            spinCooldown: 1000,     // Время восстановления спина в мс
            rareChanceBoost: 0,     // Бонус к шансу редких слаймов
            epicChanceBoost: 0,     // Бонус к шансу эпических слаймов
            divineChanceBoost: 1,   // Множитель шанса божественных слаймов
            timeReduction: 0        // Сокращение времени восстановления
        };

        // Инициализация игры
        function initGame() {
            // Гарантируем наличие свойства created
            CRAFTS.forEach(craft => {
                if (typeof craft.created === 'undefined') {
                    craft.created = false;
                }
            });
            
            // Загрузка сохранения
            loadGame();
            
            // Настройка обработчиков событий
            spinButton.addEventListener("click", spin);
            inventoryToggle.addEventListener("click", toggleInventory);
            crafterToggle.addEventListener("click", toggleCrafter);
            saveButton.addEventListener("click", manualSave);
            loadButton.addEventListener("click", loadGame);
            resetButton.addEventListener("click", resetProgress);
            document.getElementById('animation-toggle').addEventListener('change', function(e) {
                animationEnabled = e.target.checked;
                console.log(`Анимация ${animationEnabled ? 'включена' : 'отключена'}`);
            });

            // Проверяем состояние коллекций
            checkCollections();
            
            // Рендерим коллекции
            renderCollections();
            renderIndex();

            updateActiveEffects();
            loadUIState()
            
            // Запуск автосохранения
            if (autoSaveEnabled) {
                startAutoSave();
            }
        }

        // Функция сброса прогресса
        function resetProgress() {
            if (confirm("Вы уверены, что хотите сбросить весь прогресс? Все ваши данные будут удалены.")) {
                // Сбрасываем данные в памяти
                SLIMES.forEach(slime => slime.amount = 0);
                CRAFTS.forEach(craft => craft.created = false);
                COLLECTIONS.forEach(collection => {
                    collection.completed = false;
                    collection.claimed = false;
                });
                
                // Сбрасываем бонусы
                multiplier = 10000000;
                harvestMultiplier = 1;
                spinCooldown = 1000;
                rareChanceBoost = 0;
                epicChanceBoost = 0;
                divineChanceMultiplier = 1;
                
                // Удаляем сохранение
                localStorage.removeItem('slimeCollectorSave');
                
                // Обновляем интерфейс
                if (inventoryOpen) renderInventory();
                if (crafterOpen) renderCrafter();
                renderCollections();
                
                // Сбрасываем текущий слайм
                const defaultSlime = SLIMES[0];
                slimeImage.src = defaultSlime.image;
                nameSpan.textContent = defaultSlime.name;
                chanceSpan.textContent = defaultSlime.chance;
                rarityBadge.textContent = getRarityName(defaultSlime.rarity);
                rarityBadge.className = `rarity-badge ${defaultSlime.rarity}`;
                
                console.log("Прогресс сброшен!");
                renderIndex()
                renderActiveEffects();
            }
        }

        // Расширенный метод спин для обработки всех типов слаймов
        function spin() {
            if (isSpinning) {
                spinQueue++;
                return;
            }

            isSpinning = true;
            spinButton.disabled = true;
            
            if (animationEnabled) {
                // Показываем анимацию вращения
                spinningEffect.style.display = "block";
                spinningEffect.style.animation = "none";
                setTimeout(() => {
                    spinningEffect.style.animation = "spin 1s infinite linear";
                }, 10);
                
                // Анимированный спин
                let spinCount = 0;
                const spinInterval = setInterval(() => {
                    const randomSlime = SLIMES[Math.floor(Math.random() * SLIMES.length)];
                    
                    // Проверяем, известен ли слайм
                    const isKnown = randomSlime.amount > 0;
                    
                    // Устанавливаем изображение
                    slimeImage.src = isKnown ? randomSlime.image : UNKNOWN_SLIME_IMAGE;
                    
                    // Устанавливаем имя
                    nameSpan.textContent = isKnown ? randomSlime.name : "???";
                    
                    // Устанавливаем редкость
                    if (isKnown) {
                        rarityBadge.textContent = getRarityName(randomSlime.rarity);
                        rarityBadge.className = `rarity-badge ${randomSlime.rarity}`;
                    } else {
                        rarityBadge.textContent = "???";
                        rarityBadge.className = "rarity-badge unknown";
                    }
                    
                    // Устанавливаем шанс
                    chanceSpan.textContent = isKnown ? randomSlime.chance : "???";
                    
                    spinCount++;
                    if (spinCount > 10) {
                        clearInterval(spinInterval);
                        selectFinalSlime();
                    }
                }, 150);
            } else {
                // Мгновенный спин без анимации
                setTimeout(() => {
                    selectFinalSlime();
                }, 50);
            }
        }

        // Функция для выбора финального слайма
        function selectFinalSlime() {
            const maxRange = 10000000000;
            const randomNum = Math.floor(Math.random() * maxRange) + 1;
            
            let selectedSlime = null;
            let candidates = [];
            
            for (const slime of SLIMES) {
                let chanceValue = parseInt(slime.chance.split('/')[1]);
                
                // Применяем бустеры к шансам
                if (slime.rarity === "rare") {
                    chanceValue = Math.max(1, Math.floor(chanceValue * (1 - activeEffects.rareChanceBoost)));
                } else if (slime.rarity === "epic") {
                    chanceValue = Math.max(1, Math.floor(chanceValue * (1 - activeEffects.epicChanceBoost)));
                } else if (slime.rarity === "divine") {
                    chanceValue = Math.max(1, Math.floor(chanceValue / activeEffects.divineChanceBoost));
                }
                
                if (randomNum % chanceValue === 0) {
                    candidates.push(slime);
                }
            }
            
            selectedSlime = candidates.length > 0 ? 
                candidates[Math.floor(Math.random() * candidates.length)] : 
                SLIMES[0];
            
            // Применяем множитель количества
            const count = activeEffects.harvestMultiplier;
            selectedSlime.amount += count;
            
            if (animationEnabled) {
                setTimeout(() => {
                    updateSlimeDisplay(selectedSlime);
                    finishSpin();
                }, 500);
            } else {
                updateSlimeDisplay(selectedSlime);
                finishSpin();
            }
            
            console.log(`Получено ${count} ${selectedSlime.name}`);
        }
        function updateSlimeDisplay(slime) {
            slimeImage.src = slime.image;
            nameSpan.textContent = slime.name;
            chanceSpan.textContent = slime.chance;
            rarityBadge.textContent = getRarityName(slime.rarity);
            rarityBadge.className = `rarity-badge ${slime.rarity}`;
            
            if (slime.rarity !== "common") {
                console.log(`Вы получили редкого слайма: ${slime.name}!`);
            }
        }
        function finishSpin() {
            if (animationEnabled) {
                spinningEffect.style.display = "none";
            }
            
            isSpinning = false;
            
            if (spinQueue > 0) {
                spinQueue--;
                spin();
            } else {
                spinButton.disabled = false;
            }
            
            checkCollections();
            
            renderIndex();
            // Обновляем интерфейс коллекций
            renderCollections();

            if (inventoryOpen) renderInventory();
        }
        // Получение названия редкости
        function getRarityName(rarity) {
            const names = {
                'common': 'Обычный',
                'uncommon': 'Необычный',
                'rare': 'Редкий',
                'epic': 'Эпический',
                'legendary': 'Легендарный',
                'mythic': 'Мифический',
                'divine': 'Божественный'
            };
            return names[rarity] || rarity;
        }

        // Переключение видимости инвентаря
        function toggleInventory() {
            if (crafterOpen) {
                crafterOpen = false;
                crafter.style.display = "none";
                hammerImage.src = "assets/png/hammer.png";
            }
            
            inventoryOpen = !inventoryOpen;
            inventory.style.display = inventoryOpen ? "block" : "none";
            
            if (inventoryOpen) {
                renderInventory();
            }
        }

        // Отображение инвентаря
        function renderInventory() {
            inventory.innerHTML = "";
            
            SLIMES.forEach(slime => {
                if (slime.amount > 0) {
                    const slimeElement = document.createElement("div");
                    slimeElement.className = "slime-item";
                    slimeElement.innerHTML = `
                        <img src="${slime.image}" alt="${slime.name}">
                        <div>
                            <h3>${slime.name}</h3>
                            <p>Шанс: ${slime.chance}</p>
                            <p>Количество: ${slime.amount}</p>
                            <div class="rarity-badge ${slime.rarity}">${getRarityName(slime.rarity)}</div>
                        </div>
                    `;
                    inventory.appendChild(slimeElement);
                }
            });
            
            if (inventory.innerHTML === "") {
                inventory.innerHTML = "<p>Ваш инвентарь пуст. Покрутите рулетку, чтобы получить слаймов!</p>";
            }
        }

        // Переключение видимости крафта
        function toggleCrafter() {
            if (inventoryOpen) {
                inventoryOpen = false;
                inventory.style.display = "none";
                backpackImage.src = "assets/png/backpack.png";
            }
            
            crafterOpen = !crafterOpen;
            crafter.style.display = crafterOpen ? "block" : "none";
            
            if (crafterOpen) {
                renderCrafter();
            }
        }

        // Отображение рецептов крафта
        function renderCrafter() {
            crafter.innerHTML = "";
            crafter.innerHTML = "";
            
            CRAFTS.forEach((craft, index) => {
                // Проверяем наличие свойства created
                if (typeof craft.created === 'undefined') {
                craft.created = false;
                }
                // ... остальной код ...
 
            
                const craftElement = document.createElement("div");
                craftElement.className = "craft-recipe";
                craftElement.innerHTML = `
                    <h3>${craft.name}</h3>
                    <p>${craft.effect}</p>
                    ${craft.created 
                    ? '<div class="crafted-badge">Уже создан!</div>' 
                    : `<div class="craft-item">
                        <img src="${craft.image}" alt="${craft.name}">
                        <button class="craft-button" data-index="${index}">Создать</button>
                        </div>`
                    }
                    <h4>Требуется:</h4>
                `;
                
                craft.cost.forEach(item => {
                    const slime = SLIMES.find(s => s.name === item.name);
                    const hasEnough = slime && slime.amount >= item.amount;
                    
                    const costElement = document.createElement("div");
                    costElement.className = "craft-item";
                    costElement.innerHTML = `
                        <img src="${slime.image}" alt="${item.name}">
                        <span>${item.name} - ${item.amount} (${slime ? slime.amount : 0}/${item.amount})</span>
                        ${hasEnough ? "✅" : "❌"}
                    `;
                    craftElement.appendChild(costElement);
                });
                
                crafter.appendChild(craftElement);
            });
            
            // Добавляем обработчики для кнопок крафта
            document.querySelectorAll(".craft-button").forEach(button => {
                button.addEventListener("click", function() {
                    const index = parseInt(this.getAttribute("data-index"));
                    craftItem(index);
                });
            });
        }

        function renderActiveEffects() {
        const effectsList = document.getElementById("effects-list");
        effectsList.innerHTML = "";
        
        const effects = [];
        
        // Собираем эффекты от амулетов
        CRAFTS.filter(craft => craft.created).forEach(craft => {
            effects.push({
                name: craft.name,
                description: craft.effect,
                icon: craft.image
            });
        });
        
        // Собираем эффекты от коллекций
        COLLECTIONS.filter(c => c.claimed).forEach(collection => {
            effects.push({
                name: collection.name,
                description: `Коллекция: ${collection.reward}`,
                icon: collection.thumbnail
            });
        });
        
        // Добавляем системные эффекты
        if (activeEffects.harvestMultiplier > 1) {
            effects.push({
                name: "Множитель урожая",
                description: `x${activeEffects.harvestMultiplier} слаймов за спин`,
                icon: "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCI+PHBhdGggZD0iTTE5IDE5SDVWNWg3VjNINWMtMS4xIDAtMiAuOS0yIDJ2MTRjMCAxLjEuOSAyIDIgMmgxNGMxLjEgMCAyLS45IDItMnYtN2gtMnY3ek0xNCAzdjJoMy41OWwtOS44MyA5LjgzIDEuNDEgMS40MUwxOSA2LjQxVjEwaDJWM2gtN3oiLz48L3N2Zz4="
            });
        }
        
        if (activeEffects.timeReduction > 0) {
            effects.push({
                name: "Ускорение",
                description: `Восстановление на ${Math.round(activeEffects.timeReduction * 100)}% быстрее`,
                icon: "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCI+PHBhdGggZD0iTTEzIDNoLTJ2OGg4di0yaC02VjN6bS0yLjI0IDEyLjc1bC0xLjQxLTEuNDFMMi40MSAxOC42bDcuMTkgNy4xOSAxLjQxLTEuNDEtNS43OC01Ljc5eiIvPjwvc3ZnPg=="
            });
        }
        
        // Рендерим эффекты
        effects.forEach(effect => {
            const effectElement = document.createElement("div");
            effectElement.className = "active-effect";
            effectElement.innerHTML = `
                <img src="${effect.icon}" width="30" height="30">
                <div>
                    <strong>${effect.name}</strong>
                    <div>${effect.description}</div>
                </div>
            `;
            effectsList.appendChild(effectElement);
        });
        
        if (effects.length === 0) {
            effectsList.innerHTML = "<p>Нет активных эффектов</p>";
        }
    }

    function renderIndex() {
        const indexContainer = document.getElementById("slime-index");
        if (!indexContainer) return;
        
        indexContainer.innerHTML = "";
        
        // Счетчики для статистики
        const totalSlimes = SLIMES.length;
        const collectedSlimes = SLIMES.filter(s => s.amount > 0).length;
        const progressPercent = Math.round((collectedSlimes / totalSlimes) * 100);
        
        // Заголовок с прогрессом
        const progressHeader = document.createElement("div");
        progressHeader.className = "panel-header";
        progressHeader.innerHTML = `
            <h3>Прогресс: ${collectedSlimes}/${totalSlimes} (${progressPercent}%)</h3>
        `;
        indexContainer.appendChild(progressHeader);
        
        // Контейнер для сетки слаймов
        const gridContainer = document.createElement("div");
        gridContainer.className = "slime-index-grid";
        indexContainer.appendChild(gridContainer);
        
        // Сортируем слаймы по редкости
        const rarityOrder = ['divine', 'mythic', 'legendary', 'epic', 'rare', 'uncommon', 'common'];
        const sortedSlimes = [...SLIMES].sort((a, b) => {
            return rarityOrder.indexOf(a.rarity) - rarityOrder.indexOf(b.rarity);
        });
        
        // Добавляем каждый слайм в индекс
        sortedSlimes.forEach(slime => {
            const isKnown = slime.amount > 0;
            const item = document.createElement("div");
            item.className = `slime-index-item ${isKnown ? 'known' : 'unknown'}`;
            
            item.innerHTML = `
                <div class="slime-index-icon">
                    ${isKnown 
                        ? `<img src="${slime.image}" alt="${slime.name}" width="70" height="70">` 
                        : '?'}
                </div>
                <div class="slime-index-name">${isKnown ? slime.name : '???'}</div>
                ${isKnown 
                    ? `<div class="slime-index-rarity ${slime.rarity}">${getRarityName(slime.rarity)}</div>`
                    : ''}
            `;
            
            // Добавляем тултип с информацией для известных слаймов
            if (isKnown) {
                item.title = `${slime.name}\nШанс: ${slime.chance}\nРедкость: ${getRarityName(slime.rarity)}`;
            }
            
            gridContainer.appendChild(item);
        });
    }

        function updateActiveEffects() {
        // Сбрасываем эффекты перед пересчетом
        activeEffects = {
            harvestMultiplier: 1,
            spinCooldown: 1000,
            rareChanceBoost: 0,
            epicChanceBoost: 0,
            divineChanceBoost: 1,
            timeReduction: 0
        };

        // Применяем эффекты от созданных амулетов
        CRAFTS.filter(craft => craft.created).forEach(craft => {
            switch(craft.name) {
                case "Амулет Урожая":
                    activeEffects.harvestMultiplier = 2;
                    break;
                case "Амулет Вечности":
                    activeEffects.timeReduction = 0.5;
                    break;
                case "Амулет Изобилия":
                    activeEffects.epicChanceBoost = 0.3;
                    break;
                case "Амулет Слаймов":
                    activeEffects.rareChanceBoost = 0.2;
                    break;
            }
        });

        // Применяем эффекты от завершенных коллекций
        COLLECTIONS.filter(c => c.claimed).forEach(collection => {
            switch(collection.id) {
                case "starting":
                    activeEffects.epicChanceBoost += 0.05;
                    break;
                case "elemental":
                    activeEffects.harvestMultiplier += 1;
                    break;
                case "rare_ones":
                    activeEffects.timeReduction += 0.3;
                    break;
                case "all_common":
                    activeEffects.rareChanceBoost += 0.1;
                    break;
                case "mythic_set":
                    activeEffects.divineChanceBoost *= 2;
                    break;
            }
        });

        // Применяем сокращение времени восстановления
        activeEffects.spinCooldown *= (1 - activeEffects.timeReduction);
        
        // Обновляем отображение эффектов
        renderActiveEffects();
    }
        // Создание предмета
        function craftItem(index) {
            const craft = CRAFTS[index];
            
            if (craft.created) {
                console.log("Этот амулет уже создан!");
                return;
            }

            // Проверяем, хватает ли ресурсов
            let canCraft = true;
            craft.cost.forEach(item => {
                const slime = SLIMES.find(s => s.name === item.name);
                if (!slime || slime.amount < item.amount) {
                    canCraft = false;
                }
            });
            
            if (canCraft) {
                try {
                    // Списываем ресурсы
                    craft.cost.forEach(item => {
                        const slime = SLIMES.find(s => s.name === item.name);
                        if (slime) {
                            slime.amount -= item.amount;
                        }
                    });
                    
                    // Применяем эффект
                    applyCraftEffect(craft);
                    console.log(`Вы создали: ${craft.name}!`);
                    
                    // Обновляем интерфейс
                    renderCrafter();
                    if (inventoryOpen) renderInventory();
                    renderActiveEffects();
                } catch (e) {
                    console.error("Ошибка при создании предмета:", e);
                }
            } else {
                console.log("Недостаточно материалов для создания!");
                const craftButton = document.querySelector(`.craft-button[data-index="${index}"]`);
                if (craftButton) {
                    craftButton.classList.add('craft-error');
                    setTimeout(() => craftButton.classList.remove('craft-error'), 500);
                }
            }
        }

        // Применение эффекта от крафта
        // Обновляем функции для применения эффектов
        function applyCraftEffect(craft) {
            craft.created = true;
            updateActiveEffects(); // Обновляем эффекты после создания
        }
        // Ручное сохранение
        function manualSave() {
            saveGame();
            console.log("Игра сохранена вручную!");
        }
        function checkCollections() {
            COLLECTIONS.forEach(collection => {
                let allCompleted = true;
                
                collection.slimes.forEach(req => {
                    const slime = SLIMES.find(s => s.name === req.name);
                    if (!slime || slime.amount < req.amount) {
                        allCompleted = false;
                    }
                });
                
                collection.completed = allCompleted;
            });
        }

        // Отображение коллекций
        function renderCollections() {
            collectionsContainer.innerHTML = "";
            
            COLLECTIONS.forEach(collection => {
                const collectionEl = document.createElement("div");
                collectionEl.className = "collection-item";
                
                // Рассчитываем прогресс
                let totalSlimes = 0;
                let collectedSlimes = 0;
                
                collection.slimes.forEach(req => {
                    totalSlimes += req.amount;
                    const slime = SLIMES.find(s => s.name === req.name);
                    if (slime) {
                        collectedSlimes += Math.min(slime.amount, req.amount);
                    }
                });
                
                const progressPercent = (collectedSlimes / totalSlimes) * 100;
                
                collectionEl.innerHTML = `
                    <img class="collection-thumbnail" src="${collection.thumbnail}" alt="${collection.name}">
                    <div class="collection-details">
                        <h3>${collection.name}</h3>
                        <p>${collection.description}</p>
                        
                        <div class="collection-slimes">
                            ${collection.slimes.map(req => {
                                const slime = SLIMES.find(s => s.name === req.name);
                                const hasEnough = slime && slime.amount >= req.amount;
                                return `
                                    <div class="collection-slime ${hasEnough ? 'completed' : ''}">
                                        <img src="${slime ? slime.image : ''}" alt="${req.name}">
                                        <span>${req.name} (${slime ? slime.amount : 0}/${req.amount})</span>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                        
                        <div class="collection-progress">
                            <div class="progress-bar" style="width: ${progressPercent}%"></div>
                        </div>
                        
                        <div class="collection-reward">Награда: ${collection.reward}</div>
                        
                        ${collection.completed 
                            ? collection.claimed 
                                ? `<div class="collection-status completed">Награда получена!</div>`
                                : `<button class="claim-button" data-id="${collection.id}">Получить награду</button>`
                            : `<div class="collection-status locked">Коллекция не завершена</div>`
                        }
                    </div>
                `;
                
                collectionsContainer.appendChild(collectionEl);
            });
            
            // Добавляем обработчики для кнопок получения наград
            document.querySelectorAll(".claim-button").forEach(button => {
                button.addEventListener("click", function() {
                    const collectionId = this.getAttribute("data-id");
                    claimCollectionReward(collectionId);
                });
            });
        }

        // Получение награды за коллекцию
        function claimCollectionReward(collectionId) {
            const collection = COLLECTIONS.find(c => c.id === collectionId);
            
            if (!collection || !collection.completed || collection.claimed) {
                return;
            }
            
            // Помечаем коллекцию как завершенную
            collection.claimed = true;
            
            // Применяем бонус
            applyCollectionBonus(collection);
            
            // Обновляем интерфейс
            renderCollections();
            
            // Сохраняем игру
            saveGame();
            
            console.log(`Награда за коллекцию "${collection.name}" получена!`);
        }

        // Применение бонусов от коллекций
        function applyCollectionBonus(collection) {
            collection.claimed = true;
            updateActiveEffects(); // Обновляем эффекты после получения награды
        }

        function toggleCollections() {
        collectionsVisible = !collectionsVisible;
        document.querySelector('.collections-area').style.display = collectionsVisible ? 'block' : 'none';
        document.getElementById('toggle-collections').textContent = 
            collectionsVisible ? 'Скрыть коллекции' : 'Показать коллекции';
        saveUIState();
    }
    
    function toggleIndex() {
        indexVisible = !indexVisible;
        document.querySelector('.index-area').style.display = indexVisible ? 'block' : 'none';
        document.getElementById('toggle-index').textContent = 
            indexVisible ? 'Скрыть индекс' : 'Показать индекс';
        saveUIState();
    }
    
    // Сохранение состояния UI
    function saveUIState() {
        const uiState = {
            collectionsVisible,
            indexVisible
        };
        localStorage.setItem('slimeUIState', JSON.stringify(uiState));
    }
    
    // Загрузка состояния UI
    function loadUIState() {
        const savedUI = localStorage.getItem('slimeUIState');
        if (savedUI) {
            try {
                const uiState = JSON.parse(savedUI);
                collectionsVisible = uiState.collectionsVisible;
                indexVisible = uiState.indexVisible;
                
                // Применяем сохраненное состояние
                document.querySelector('.collections-area').style.display = 
                    collectionsVisible ? 'block' : 'none';
                document.querySelector('.index-area').style.display = 
                    indexVisible ? 'block' : 'none';
                
                // Обновляем текст кнопок
                document.getElementById('toggle-collections').textContent = 
                    collectionsVisible ? 'Скрыть коллекции' : 'Показать коллекции';
                document.getElementById('toggle-index').textContent = 
                    indexVisible ? 'Скрыть индекс' : 'Показать индекс';
            } catch (e) {
                console.error('Ошибка загрузки состояния UI', e);
            }
        }
    }

        // Сохранение игры
        function saveGame() {
            const saveData = {
                slimes: SLIMES.map(slime => ({ 
                    name: slime.name, 
                    amount: slime.amount 
                })),
                crafts: CRAFTS.map(craft => ({
                    name: craft.name,
                    created: craft.created
                })),
                collections: COLLECTIONS.map(c => ({
                    id: c.id,
                    completed: c.completed,
                    claimed: c.claimed
                })),
                // Добавляем сохранение бонусов
                gameState: {
                    multiplier: multiplier,
                    harvestMultiplier: harvestMultiplier,
                    spinCooldown: spinCooldown,
                    rareChanceBoost: rareChanceBoost,
                    epicChanceBoost: epicChanceBoost,
                    divineChanceMultiplier: divineChanceMultiplier
                },
                lastSave: new Date().toISOString()
            };
            
            localStorage.setItem('slimeCollectorSave', JSON.stringify(saveData));
        }

        function loadGame() {
            const saved = localStorage.getItem('slimeCollectorSave');
            if (saved) {
                try {
                    const saveData = JSON.parse(saved);
                    
                    // Восстанавливаем множитель
                    multiplier = saveData.multiplier || 10000000;
                    
                    // Восстанавливаем количество для каждого слайма
                    saveData.slimes.forEach(savedSlime => {
                        const slime = SLIMES.find(s => s.name === savedSlime.name);
                        if (slime) {
                            slime.amount = savedSlime.amount;
                        }
                    });

                    if (saveData.gameState) {
                        multiplier = saveData.gameState.multiplier || 10000000;
                        harvestMultiplier = saveData.gameState.harvestMultiplier || 1;
                        spinCooldown = saveData.gameState.spinCooldown || 1000;
                        rareChanceBoost = saveData.gameState.rareChanceBoost || 0;
                        epicChanceBoost = saveData.gameState.epicChanceBoost || 0;
                        divineChanceMultiplier = saveData.gameState.divineChanceMultiplier || 1;
                    }
                    
                    // Восстанавливаем состояние крафтов (если есть в сохранении)
                    if (saveData.crafts) {
                        saveData.crafts.forEach(savedCraft => {
                            const craft = CRAFTS.find(c => c.name === savedCraft.name);
                            if (craft) {
                                craft.created = savedCraft.created;
                                // Применяем эффект, если амулет уже создан
                                if (craft.created) {
                                    applyCraftEffect(craft);
                                }
                            }
                        });
                    }
                    if (saveData.collections) {
                        saveData.collections.forEach(savedCollection => {
                            const collection = COLLECTIONS.find(c => c.id === savedCollection.id);
                            if (collection) {
                                collection.completed = savedCollection.completed;
                                collection.claimed = savedCollection.claimed;
                                
                                // Применяем бонусы, если награда была получена
                                if (collection.claimed) {
                                    applyCollectionBonus(collection);
                                }
                            }
                        });
                    }
                    
                    // Обновляем интерфейс
                    updateActiveEffects();
                    if (inventoryOpen) renderInventory();
                    if (crafterOpen) renderCrafter();
                    renderIndex()
                    
                    console.log("Игра загружена!");
                } catch (e) {
                    console.error('Ошибка загрузки сохранения', e);
                }
            } else {
                console.log("Сохранение не найдено");
            }
        }

        // Запуск автосохранения
        function startAutoSave() {
            autoSaveInterval = setInterval(() => {
                saveGame();
            }, 30000); // 30 секунд
        }

        // Запуск игры при загрузке страницы
        window.addEventListener("DOMContentLoaded", initGame);
        
        // Добавляем анимацию вращения в CSS
        const style = document.createElement('style');
        style.innerHTML = `
            @keyframes spin {
                0% { transform: translateX(-50%) scale(0.5); opacity: 0; }
                50% { transform: translateX(-50%) scale(1.2); opacity: 0.5; }
                100% { transform: translateX(-50%) scale(0.5); opacity: 0; }
            }
                .active-effect {
            display: flex;
            align-items: center;
            padding: 8px;
            background: #f5f5f5;
            border-radius: 8px;
            margin-bottom: 8px;
        }
        .active-effect img {
            margin-right: 10px;
            border-radius: 4px;
        }
        .active-effect div {
            flex: 1;
        }
        .active-effect strong {
            display: block;
            font-size: 14px;
        }
        .active-effect div div {
            font-size: 12px;
            color: #666;
        }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>